<h1 class="mb-4">Ingressos da Compra</h1>

<% @order.order_items.each do |item| %>
  <% code = item.qr_code.to_s.presence || "NO-CODE-#{item.id}" %>
  <% qr = RQRCode::QRCode.new(code) %>

  <div class="ticket mb-5">

    <% if item.event.image.attached? %>
      <div class="ticket-header">
        <%= image_tag item.event.image, class: "ticket-image" %>
      </div>
    <% end %>

    <div class="ticket-body row g-0">

      <div class="col-md-8 p-4">
        <h2 class="ticket-title"><%= item.event.name %></h2>

        <p class="ticket-info">
          <strong>Quantidade:</strong> <%= item.quantity %><br>
          <strong>Preço unitário:</strong> R$ <%= number_with_precision(item.price, precision: 2) %><br>
          <strong>Data da compra:</strong> <%= item.order.created_at.strftime("%d/%m/%Y %H:%M") %>
        </p>

        <div class="ticket-code">
          <span><%= item.qr_code %></span>
        </div>
      </div>

      <div class="col-md-4 text-center p-4 ticket-qr">
        <div class="qr-wrapper">
          <%= raw qr.as_svg(
            offset: 0,
            color: '000',
            shape_rendering: 'crispEdges',
            module_size: 6,
            standalone: true
          ) %>
        </div>
        <p class="mt-3 text-muted">Apresente este código na entrada</p>
      </div>

    </div>
  </div>
<% end %>

<div class="alert alert-dark text-end fs-4">
  <strong>Total pago:</strong> R$ <%= number_with_precision(@order.total, precision: 2) %>
</div>
